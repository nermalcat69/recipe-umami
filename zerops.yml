zerops:
  - setup: umami
    build:
      base: nodejs@18
      buildCommands:
        - | 
          git clone https://github.com/umami-software/umami.git
          cd umami
          yarn install
          yarn build-docker
          rm -rf node_modules
          mv package.json package.json.backup
          echo '{}' > package.json
          yarn add npm-run-all dotenv prisma semver
          rm package.json
          mv package.json.backup package.json
      deploy: 
        - ./umami/~.next/standalone/
        - ./umami/~.next/static/
        - ./umami/~public/
        - ./umami/~scripts/
        - ./umami/~prisma/
        - ./umami/~next.config.js
        - ./umami/~package.json
        - ./umami/~node_modules/
    run: 
      start: yarn start-docker
    envVariables:
      DATABASE_TYPE: postgresql
      DATABASE_URL: ${db_connectionString}/${db_hostname}
      NODE_ENV: production
      NEXT_TELEMETRY_DISABLED: "1"
